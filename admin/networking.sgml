<!-- $Id$ -->
<chapter id="net">
<title>Netværksprogrammer</title>

<para>
En vigtig start-kommentar, som kunne stå mange steder i denne bog er
at der med Linux-kerne 2.4 (f.eks. Red Hat 7.1 og Mandrake 8.0) er
problemer med at få tilgang til alle hjemmesider - det er et
problem som er forstået nu, se f.eks. <ulink
url="http://eltoday.com/article.php3?ltsn=2001-04-17-001-14-PS">http://eltoday.com/article.php3?ltsn=2001-04-17-001-14-PS</ulink>.
Løsningen er simpel. Tilføj følgende til f.eks. 
<filename>/etc/rc.d/rc.local</filename>:
</para>

<screen>
echo "0" &gt; /proc/sys/net/ipv4/tcp_ecn
</screen>

<para>
Lad os nu se på de programmer en netværksadministrator bør kende.
</para>
<indexterm>
 <primary>ping</primary>
</indexterm>
<indexterm>
 <primary>Kommandooversigt</primary>
 <secondary>ping</secondary>
</indexterm>

<sect1 id="ping">
<title>Ping</title>
<indexterm><primary>ping</primary></indexterm>
<para>
<command>ping</command> er et meget simpelt, men utroligt nyttigt
stykke værktøj, som bruges til at finde ud af, om der kan opnås
forbindelse til en IP-adresse. Sagt på en anden måde er
<command>ping</command> det program, du kan bruge til at finde ud af, om
der er "hul igennem".
</para>

<para>
<command>ping</command> bør altid være det første program, du bruger
til at diagnosticere et netværksproblem. Hvis det lykkes at pinge til
en adresse, ved du, at den fysiske forbindelse er i orden, og de basale
dele af netværket fungerer.
</para>

<para>
<command>ping</command> køres sådan her:
</para>

<screen>
<prompt>[anne@linus ~]$ </prompt><userinput>ping -c 4 www.linux.org</userinput>
</screen>

<para>
Ved at skrive "-c 4" beder vi <command>ping</command> om at nøjes med
at sende fire pakker, ellers bliver den ved, indtil vi stopper den med Ctrl-c.
</para>

<para>
<command>ping</command> svarer tilbage:
</para>

<screen>
PING www.linux.org (198.182.196.51): 56 data bytes
64 bytes from 198.182.196.51: icmp_seq=0 ttl=42 time=479.3 ms
64 bytes from 198.182.196.51: icmp_seq=1 ttl=42 time=710.0 ms
64 bytes from 198.182.196.51: icmp_seq=1 ttl=41 time=730.0 ms
64 bytes from 198.182.196.51: icmp_seq=2 ttl=42 time=600.0 ms
64 bytes from 198.182.196.51: icmp_seq=3 ttl=42 time=370.0 ms

--- www.linux.org ping statistics ---
4 packets transmitted, 4 packets received, +1 duplicates, 0% packet loss
round-trip min/avg/max = 370.0/577.8/730.0 ms
</screen>

<para>
Vi kan først og fremmest se, at vi kan komme igennem til
www.linux.org, som har adressen 198.182.196.51, og at alt, hvad vi
sendte, kom tilbage igen, ja faktisk kom en af de fire pakker tilbage
to gange! Hele turen frem og tilbage tog i gennemsnit 577,8
millisekunder - altså lidt over et halvt sekund. Som Alan Cox på et
tidspunkt vittigt skrev: "Afstanden mellem Bombay og New York i den nye
tidsalder er kun 250 millisekunder".
</para>

<para>
Hvis du ikke skulle få nogen pakker tilbage, er dette dog ikke 
ensbetydende med, at der er noget galt med forbindelsen til 
den anden maskine, da den kan være sat op til IKKE at svare 
på <command>ping</command>.
</para>
</sect1>

<sect1 id="telnet">
<title>telnet</title>
<indexterm>
 <primary>Kommandooversigt</primary>
 <secondary>telnet</secondary>
</indexterm>
<indexterm>
 <primary>telnet</primary>
</indexterm>
<indexterm>
 <primary>ftp</primary>
 <secondary>spærring</secondary>
</indexterm>
<para>
Med <command>telnet</command> er det muligt at logge ind på andre
computere på netværket og arbejde tekstbaseret, som om du sad ved
computeren. Dette kan også foregå på tværs af platforme, f.eks. kan du
køre <command>telnet</command> på en Windows 95-maskine og derfra logge ind
på en Linux-maskine.
</para>

<para>
Ved normal brug startes <command>telnet</command> simpelthen med
navnet på den computer, du ønsker en forbindelse til - i nedenstående eksempel
<filename>gonzo</filename>. Når forbindelsen er oprettet, vil du blive
præsenteret for en <filename>login:</filename>-prompt, og du kan nu arbejde
videre, som om du sad ved den anden maskine.
</para>

<screen>
<prompt>[anne@linus ~]$  </prompt><userinput>telnet gonzo</userinput>
Trying 192.168.100.5...
Connected to gonzo.codehell.lokal.
Escape character is '^]'.

Red Hat Linux release 6.0 (Hedwig)
Kernel 2.2.5 on an i586
login:
</screen>

<para>
Når du ikke længere har brug for telnet-forbindelsen, afbryder du
den med <command>exit</command>, og du er så tilbage på din egen maskine.
</para>

<para>
Hvis du angiver en port, som er bundet til en anden protokol, kan du også
have glæde af <command>telnet</command> til fejlfinding og testbrug. I
en snæver vending kan du bruge <command>telnet</command> til at hente
post hos din Internetudbyder!
</para>

<para>
For at beskytte din installation er standardinstallationen lavet,
så "root" ikke kan logge ind fra en anden maskine med 
<command>telnet</command> og
<command>ftp</command>. Det er gjort for, at man ikke helt så nemt kan få
adgang til root's adgangskode. Hvis du har maskinen på et usikkert net -
f.eks. Internettet - bør du ikke ændre på dette. I stedet kan du bruge
krypteret netkommunikation - f.eks. med "Secure Shell" eller den frie udgave
"OpenSSH" (sikker shell).
Har du et lukket net og mener, at du ikke gider at gå ind som almindelig
bruger og derefter lave <command>su - root</command>, kan du godt få lov
til at bruge <command>telnet</command> og
<command>ftp</command> som root udefra. Filerne
<filename>/etc/securetty</filename> og <filename>/etc/ftpusers</filename>
kan rettes eller direkte slettes, så kan root
logge ind udefra.
</para>

<para>
Som telnet-klient på en Microsoft Windows-maskine kan 
benyttes PuTTY, som også understøtter SSH. Med PuTTY 
ligner det langt mere det, at sidde direkte på en 
Linux-konsol i forhold til den telnet-klient, som 
følger med Microsoft Windows. Du kan se mere om PuTTY på  
<ulink url="http://www.chiark.greenend.org.uk/~sgtatham/putty/">http://www.chiark.greenend.org.uk/~sgtatham/putty/</ulink>
</para>
</sect1>

<sect1 id="ftp">
<title>ftp</title>

<indexterm>
 <primary>ftp</primary>
 <secondary>bruger, klient</secondary>
</indexterm>

<indexterm>
 <primary>ftp </primary>
</indexterm>

<indexterm>
 <primary>Kommandooversigt</primary>
 <secondary>ftp </secondary>
</indexterm>

<para>
Til at hente og sende filer over TCP/IP bruges programmet
<command>ftp</command>.
</para>

<para>
Hvis du skal bruge en fil fra <filename>sunsite.dk</filename>,
skriver du sådan her: 
</para>

<screen>
<prompt>[anne@linus ~]$ </prompt> <userinput>ftp sunsite.dk</userinput>
</screen>

<para>
Når forbindelsen er klar, spørger computeren om brugernavn og
adgangskode. Du kan logge på som 'anonymous' (anonym) og give din
e-post-adresse som adgangskode. Bemærk, at e-postadressen ikke er synlig,
når den tastes ind.
</para>

<screen>
Connected to sunsite.dk.
220 sunsite.dk FTP server (NcFTPd 2.2.2) ready.
Name (sunsite.dk:anne): <userinput>anonymous</userinput>
331 Guest login ok, send your complete e-mail address as password.
Password:
230-You are user #57 of 300 simultaneous users allowed.
230-
230-                 Welcome to SunSITE Denmark
230-                 ==========================
230-
230-SunSITE Denmark is located at Aalborg University, Institute of
230-Electronic Systems, Denmark, and is running on a SPARCserver 1000 with
230-4 CPUs, 416 MB Memory and approximately 110 GB storage.
230-

[lang velkomsthilsen klippet ud]

230-
230 Logged in anonymously.
Remote system type is UNIX.
Using binary mode to transfer files.
</screen>

<para>
Så står du ved en <prompt>ftp></prompt>-prompt, hvor du kan bevæge dig
rundt i katalogerne med <command>cd</command> og se indholdet med
<command>ls</command> - ganske som med en almindelig kommandolinje.
</para>

<screen>
<prompt>ftp></prompt> <userinput>ls</userinput>
200 PORT command successful.
150 Opening ASCII mode data connection for /bin/ls.
drwxrwxr-x  60 ftpuser  ftpusers      8192 Oct 10 16:23 disk1
drwxrwxr-x   9 ftpuser  ftpusers      2048 Oct 10 15:45 disk2
drwxr-xr-x   3 ftpuser  ftpusers        96 Jun  2 17:02 disk3
drwxr-xr-x   4 ftpuser  ftpusers        96 Sep  1 09:15 disk4
... [mange kataloger klippet væk]
226 Listing completed.
</screen>

<para>
Hvis du nu ved hjælp af <command>cd</command> navigerer ned i
<filename>/pub/os/linux/Red Hat</filename> og kører
<command>ls</command>, vil du se, at der ligger en fil ved navn
<filename>README</filename>, som du gerne vil hente hjem på din egen
maskine med kommandoen <command>get README</command>.
</para>

<para>
Nu er filen ikke særlig stor, så den er hentet ned på et øjeblik.
Hvis du henter større ting, er det som regel rart at kunne se, om der er
"flow" i overførslen. Med kommandoen <command>hash</command> kan du få
skrevet et #-tegn ("hash mark"), hver gang en blok er blevet overført.
</para>

<screen>
<prompt>ftp></prompt> <userinput>hash</userinput>
Hash mark printing on (1024 bytes/hash mark).
</screen>

<para>
Så henter du filen:
</para>

<screen>
<prompt>ftp></prompt> <userinput>get README</userinput>
local: README remote: README
200 PORT command successful.
150 Opening BINARY mode data connection for README (1155 bytes).
#
226 Transfer completed.
1155 bytes received in 0.227 secs (5 Kbytes/sec)
</screen>

<para>
<filename>README</filename> er en ganske lille fil, så det vil
kun blive til et enkelt #-tegn. Læg i øvrigt mærke til, at den er
overført som binær fil (BINARY) i modsætning til ren tekst (ASCII). Hvis du
bruger ASCII til overførslen, vil <command>ftp</command> konvertere
linjeskift i tekstfiler til det korrekte format for den maskine, der
modtager filen. Det er udmærket til tekstfiler, men kan smadre f.eks.
grafik og komprimerede filer fuldstændigt. Til at skifte mellem binær
og ASCII bruges ftp-kommandoerne <command>bin</command> og
<command>ascii</command>.
</para>

<para>
Nu er du færdig med at hente, hvad du skal bruge, og du logger ud igen
med kommandoen <command>quit</command>. Derefter er du tilbage på
kommandolinjen på din egen maskine.
</para>


<para>
<indexterm><primary>anonym ftp</primary></indexterm>
<indexterm><primary>ftp</primary><secondary>anonym</secondary></indexterm>
Hvis du har brug for at tilbyde anonym ftp på din Linux-maskine, kan du i
Red Hat Linux og nogle andre distributioner 
installere pakken "anonftp". Pakken foretager hele
opsætningen for dig. Filer, der skal kunne hentes via anonym ftp, lægges
så blot i <filename>/home/ftp/pub</filename>.
</para>

<para>
Alt det ovenstående handler om anonymt ftp. Hvis du er oprettet som bruger
på den maskine, du skal i kontakt med, kan du logge på med dit rigtige
brugernavn og adgangskode. På den måde får du så rettigheder til at
hente og sende filer i forhold til, hvad du er blevet tildelt af
administratoren.
</para>

<indexterm><primary>Midnight Commander</primary></indexterm>
<indexterm><primary>mc</primary></indexterm>

<para>
Man kan også bruge Midnight Commander til at hente filer 
fra en FTP-server. Du åbner Midnight Commander med kommandoen 
<command>mc</command>. Med funktionstasten F9 får du fat i 
menuen og trækker ned med pil-ned. Vælg så "FTP link...".
</para>

<para>
Indtast evt. brugernavn og adgangskode adskilt med et kolon (:), så 
et snabel-a (@), hvorefter navnet på selve FTP-serveren angives.
Hvis det drejer sig om en anonym FTP-server kan man udelade alt 
andet end serverens navn. Det kan se sådan ud:
</para>

<screen>
<userinput>brugernavn:adgangskode@ftp.server.net</userinput>
</screen>

<para>
En hurtig og grafisk metode til at overføre filer via FTP.
</para>
<sidebar>
 <para>
 Opsætning af ftp-tjeneste se afsnit <xref linkend="ftpd">.
 </para>
</sidebar>

</sect1>


<sect1 id="wget">
 <title>wget</title>

<indexterm>
 <primary>wget</primary>
</indexterm>

<indexterm>
 <primary>Kommandooversigt</primary>
 <secondary>wget</secondary>
</indexterm>

<indexterm>
 <primary>hente hjemmesider</primary>
</indexterm>

<indexterm>
 <primary>afspejling af hjemmesider</primary>
</indexterm>

<indexterm>
 <primary>spejling af hjemmesider</primary>
</indexterm>

 <para>
  Fra tid til anden har du brug for at kunne hente en stribe hjemmesider, som
  du sidenhen vil kunne læse - for eksempel programvejledninger. Med Netscape
  er det besværligt, idet du skal trykke "gem" for hver enkelt side. Meget
  smartere er programmet <command>wget</command>, der kan hente rekursivt fra
  en http- eller ftp-side, såsom SSLUG's adresse.
 </para>

<screen>
<prompt>[anne@linus ~]$ </prompt> <userinput>wget -r http://www.sslug.dk/</userinput></screen>

<PARA>
Ovenstående kommando henter hele SSLUG's hjemmeside.  Er det kun de
underliggende kataloger der skal hentes, tilføjes <COMMAND>-np</COMMAND>
(no parents). Dette kan bruges til at hente denne bog fra
www.sslug.dk.  I nogle HTML-sider er der angivet direkte link. Dette
kan fjernes med <COMMAND>-k</COMMAND>.
</PARA>

<screen>
<prompt>[anne@linus ~]$ </prompt> <userinput>wget -r -k -np http://www.sslug.dk/linuxbog/friheden/bog/</userinput></screen>

<para>
Et lille trick er at bruge <command>wget -c
ftp://ftpsted/storfil.tgz</command>, hvor -c står for continue og hvis
man husker den ved alle store downloads, så kan programmet finde ud af at
fortsætte afbrudte nedhentninger. Fed funktionalitet hvis man vil hente noget
stort over en ustabil forbindelse.
</para>

<PARA>
Se også <XREF LINKEND="ncftp"> om <command>ncftp</command> som kan
anvendes til at downloade filer.
</PARA>

</sect1>

<SECT1 ID="ncftp">
<TITLE>ncftp</TITLE>
<INDEXTERM>
 <PRIMARY>ncftp</PRIMARY>
</INDEXTERM>
<INDEXTERM>
 <PRIMARY>ftp</PRIMARY>
 <SECONDARY>klient</SECONDARY>
</INDEXTERM>
<indexterm>
 <primary>Kommandooversigt</primary>
 <secondary>ncftp</secondary>
</indexterm>
<indexterm>
 <primary>Kommandooversigt</primary>
 <secondary>ncftpget</secondary>
</indexterm>
<PARA>
Programmet <COMMAND>ncftp</COMMAND> er en ftp-lignende klient,
som er nem at bruge til <COMMAND>anonymous</COMMAND>
download. Man skal ikke angive brugernavn og adgangskode.
Prøv f.eks:
</PARA>

<SCREEN>
<PROMPT>[anne@linus ~]$ </PROMPT><USERINPUT>ncftp sunsite.dk</USERINPUT>
</SCREEN>

<PARA>
<COMMAND>ncftp</COMMAND> kan en masse ting der
gør det væsentligt nemmere at bruge end det basale ftp-program.
</PARA>

<SECT2 ID="ncftpget">
<TITLE>ncftpget</TITLE>
<INDEXTERM><PRIMARY>ncftp</PRIMARY><SECONDARY>ncftpget</SECONDARY></INDEXTERM>
<INDEXTERM><PRIMARY>wget</PRIMARY><SECONDARY>ncftpget</SECONDARY></INDEXTERM>

<PARA>
<COMMAND>ncftpget</COMMAND> er en videreudvikling af
<COMMAND>ncftp</COMMAND> som er specielt velegnet til at hente mange
filer fra en anden server, ved blot at angive hvad man vil hente på
kommandolinjen.  Skal du hente filer i
<filename>/home/mig/public_html</filename> fra maskinen
ftp.serv.dk, hvor du har en brugerkonto
<EMPHASIS>mig</EMPHASIS>, kan det gøres med følgende kommando:
</PARA>

<SCREEN>
<PROMPT>[anne@linus ~]$ </PROMPT><USERINPUT>cd temp</USERINPUT>
<PROMPT>[anne@linus temp]$ </PROMPT><USERINPUT>ncftpget -R -u mig ftp.serv.dk . public_html</USERINPUT>
</SCREEN>

<PARA>
<OPTION>-R</OPTION> gør at alle filer i underkataloger også
bliver hentet. <OPTION>-u mig</OPTION> angiver brugernavn og
da man ikke bør angive adgangskode på kommandolinjen, bliver
man spurgt om adgangskode. Punktum angiver det katalog du
står i, hvilket giver et godt overblik over hvor filerne havner.
<COMMAND>ncftpget</COMMAND> har mange flere muligheder
der er velegnede til automatiserede formål.
</PARA>
</SECT2><!-- ncftpget -->

<SECT2 ID="ncftpput">
<TITLE>ncftpput</TITLE>
<indexterm>
 <primary>ncftpput</primary>
</indexterm>
<indexterm>
 <primary>Kommandooversigt</primary>
 <secondary>ncftpput</secondary>
</indexterm>
<INDEXTERM>
 <PRIMARY>ncftp</PRIMARY>
 <SECONDARY>ncftpput</SECONDARY>
</INDEXTERM>
<INDEXTERM>
 <PRIMARY>ftp</PRIMARY>
 <SECONDARY>ncftpput</SECONDARY>
</INDEXTERM>
<INDEXTERM>
 <PRIMARY>Upload filer fra kommandolinjen</PRIMARY>
</INDEXTERM>

<PARA>
<COMMAND>ncftpput</COMMAND>
er beregnet til at lægge mange filer op på en server.
Skal du lægge filer op fra <EMPHASIS>/home/linus/public_html</EMPHASIS>
til <EMPHASIS>ftp.serv.dk</EMPHASIS> i kataloget
<EMPHASIS>/home/mig/html</EMPHASIS>
hvor du har en brugerkonto <EMPHASIS>mig</EMPHASIS>,
kan det gøres med følgende kommando:
</PARA>

<SCREEN>
<PROMPT>[anne@linus ~]$ </PROMPT><USERINPUT>ncftpput -R -u mig ftp.serv.dk html public_html</USERINPUT>
</SCREEN>

<PARA>
Se også <XREF LINKEND="ncftpget">.
</PARA>
</SECT2><!-- ncftpput -->

</SECT1><!-- ncftp -->


<sect1 id="E-post">
<title>E-post</title>
<sect2 id="postserver">
<title>Linux som postserver</title>

<para>
Hvis du installerer rpm-pakken <filename>imap</filename>, kan din
Linux-maskine bruges som server for indgående post i et netværk. Ved
installationen af pakken skulle hele opsætningen faktisk være på plads,
så brugerne på de enkelte maskiner blot skal angive Linux-maskinen som
postserver i deres e-post-programmer - og så naturligvis være oprettet
som brugere på Linux-maskinen!
</para>

<para>
Hvis du kun har en modemforbindelse til Internettet, kan du lade
Linux-serveren sende og hente post for alle brugere på et lokalt
netværk. Programmet <command>fetchmail</command> (se bogen "Linux -
friheden til at lære Unix") er ret nemt at sætte op til at hente post til
flere forskellige brugere på samme tid hos Internetudbydere.
</para>

<para>
Udgående post håndteres af programmet <command>sendmail</command>. Hvis
<command>sendmail</command> skal acceptere at videresende udgående e-post
fra andre maskiner på et lokalnet, er det nødvendigt at angive dette i filen
<filename>/etc/mail/ip_allow</filename>, ellers vil forsøg på at bruge
Linux-maskinen som SMTP-server blive afvist med beskeden "We do not
relay".
</para>

<para>
I <filename>/etc/mail/ip_allow</filename> skriver du adresser på
enkelte maskiner eller netværk, som må bruge Linux-maskinen som
udgående postserver. Hvis for eksempel alle maskiner på netværket
<filename>192.168.100.0</filename> skal accepteres, skal indholdet af
<filename>/etc/mail/ip_allow</filename> være dette:
</para>

<screen>
192.168.100
</screen>

<para>
Hvis post kun skal accepteres fra nogle af maskinerne på netværket,
skrives adresserne på de enkelte godkendte maskiner. Alternativt kan
man tillade alle maskiner i eget domæne at være "relay"-maskine ved at
tilføje <filename>FEATURE(`relay_entire_domain`)</filename> i
<filename>/etc/sendmail.mc</filename> og derefter køre <command>m4
/etc/sendmail.mc /etc/sendmail.cf</command>. Bemærk, at man skal have
sendmail-cf-pakken installeret.
</para>

<para>
At tilpasse <command>sendmail</command>'s opsætning er i øvrigt
et emne, som kan fremkalde nervøse trækninger og koldsved hos store voksne
systemadministratorer. Red Hat Linux sætter <command>sendmail</command>
ganske fornuftigt op fra starten, så medmindre du er meget videbegærlig
eller masochistisk anlagt, vil vi foreslå dig at glemme alt om opsætning af
<command>sendmail</command>, indtil det er absolut nødvendigt.
Du kan med fordel erstatte Sendmail med Postfix.
Se <XREF LINKEND="postfix">.
</para>
</sect2>

<sect2 id="procmail">
<title>Sortering af e-breve med procmail</title>
<indexterm><primary>procmail</primary></indexterm>
<para>
Hvis du får mange e-breve ind pr. dag, så vil du nok hurtigt lave
forskellige foldere til forskellige emner. F.eks. kan du lave en
folder til hver af de diskussionslister på SSLUG, som du deltager i.
Et program, som du kan have meget glæde af, er
<command>procmail</command>, der kan sortere e-breve automatisk ned
til de e-post-foldere, du har oprettet. Henter du breve med fetchmail,
så kan procmail lave sorteringen ud fra konfigurationsfilen
<filename>~/.procmailrc</filename>.  I eksemplet har vi post liggende
i <filename>~/mail</filename>-kataloget, og herunder har vi
forskellige filer som er brevfoldere.
</para>

<screen>
PATH=$HOME/bin:/usr/bin:/bin:/usr/local/bin:.
MAILDIR=$HOME/mail      # Her _skal_ procmail kunne aflevere din mail.
DEFAULT=$MAILDIR/mbox   # Forvalgt folder til af aflevere e-breve i
LOGFILE=$MAILDIR/.from   # Her gemmer vi en log over hvilke e-breve der kom
LOCKFILE=$HOME/.lockmail  # Fil til at lave lås med.

# REJECT: sikkert spam e-post
# Filen ~/.procmailrc.spam indeholder da regexps der 
# matches på brevets headere.
# I ~/.procmailrc.spam kan således indsættes linjer
# ^Subject: .*(\$\$|sex|adult|offer)
# som matcher det du vil slippe for. E-post, der
# fanges af reglen gemmes i spam post-mappen
:0
* ? egrep -q -f $HOME/.procmailrc.spam
spam

# Første liste er mgp-listen for Magic Point programmet
# Vi tjekker efter To eller Cc feltet er til listen mgp-users@mew.org
# og gemmer i ~/mail/mgp
:0
*^(To:|Cc:).*mgp-users@mew.org
mgp 

# Dernæst har vi sslug-teknik som altid sætter "Reply-To" feltet
:0
*^Reply-To:.sslug-teknik@sslug.dk
sslug-teknik

# Alle breve fra brugere @imm.dtu.dk gemmer vi i IMM-folderen
:0
*^From:.*@imm.dtu.dk
IMM

# Vi kan også gemme en ekstra kopi af breve - dvs. brevet bliver 
# også processeret af de efterfølgende regler.
# Kommer der et e-brev fra statsministeren stm@stm.dk så gemmer vi lige
# en ekstra kopi i stats-folderen
:0c
*^From:.*stm@stm.dk
stats

# Endelig kan vi faktisk også udføre kommandoer via mail
# Her lader vi e-breve med emnet EJECT udføre kommandoen eject
# og da det kun er en kopi vi udtager, så vil brevet også gå til 
# det forvalgte brevfolder.

:0c
*^Subject:.eject
|/usr/bin/eject      

# Alle andre mails ender i default mail folderen. 
</screen>

<para>
En langt mere restriktiv <filename>.procmailrc</filename>-fil kan være 
</para>

<screen>
PATH=$HOME/bin:/usr/bin:/bin:/usr/local/bin:.
MAILDIR=$HOME/mail      # Her _skal_ procmail kunne aflevere din e-post.
DEFAULT=$MAILDIR/mbox   # Default folder til at aflevere ebreve i
LOGFILE=$MAILDIR/.from   # Her gemmer vi en log over hvilke ebreve der kom
LOCKFILE=$HOME/.lockmail  # Fil til at lave lås med.

:0
* ? egrep -q -f $HOME/.procmailrc.allow
$DEFAULT

:0
spam
</screen>

<para>
Alt gemmes i spam-folderen medmindre det er tilladt ved tjek i
forhold til filen <filename>~/.procmailrc.allow</filename>. Denne fil 
indeholder f.eks.
</para>

<screen>
^((Resent-)?(To|Cc|Bcc|From)): .*(anne|root|.*master)@sslug\.dk
^From: freshmeat daemon &lt;freshd@freshmeat\.net&gt;$
^Sender: Security Portal Mailing List
^Mailing-List: contact sslug-.*@sslug.dk
^To: apacheweek@apacheweek\.com$
^Delivered-To: mailing list announce@apache\.org
</screen>

<para>
I dette tilfælde er det kun e-post til anne@sslug.dk (tilsvarende
også root og postmaster), og de e-post-lister, som brugeren anne kender, der
ender i <filename>$MAILDIR/mbox</filename> - alt andet ender i
spam-folderen. Det kan anbefales at checke sin spam-folder fra tid til
anden for at være sikker på at e-post ikke er gået galt i
procmail-reglerne. Er du helt sikker på dine spam-regler, så kan du
sende mail direkte til <filename>/dev/null</filename> i stedet for
spam-folderen.
</para>

<para>
Procmail er guld værd, og <command>man procmail</command>, 
<command>man procmailex</command> og
<command>man procmailrc</command> er værd at
læse. Du kan også være glad for at lave et alias <command>alias ms
"mailstat ~/mail/.from"</command>, idet du så kan skrive
<command>ms</command> efter at have kørt fetchmail, og du vil så få
vist hvor mange breve og størrelsen af disse som er blevet fordelt til
de forskellige foldere. 
</para>

<para>
Et smart procmail-filter er følgende, som retter subject af
brevet til en advarsel om et potentielt virus-angreb hvis attachment
kan indeholde en virus.
</para>

<screen>
:0
* ^Content-type: (multipart/mixed|application/octet-stream)
{
    :0 HB
    *  ^Content-Disposition: attachment;
    *filename=.*\.(exe|vbs|shs|com|pif|bat|src|wfs|vbe|wsh|hta)
    {
        :0 fhw
        | formail -i "Subject: Attachments kan indeholde virus !"
    
        :0:
        $DEFAULT
    }
}
</screen>

</sect2>

</sect1>

<sect1 id="postfix">
<title>Postfix</title>

<indexterm><primary>Postfix</primary></indexterm>
<indexterm><primary>E-post</primary><secondary>Postfix</secondary></indexterm>
<indexterm><primary>MTA (Mail Transfer Agent)</primary><secondary>Postfix</secondary></indexterm>
<indexterm><primary>Sendmail</primary><secondary>Erstat med Postfix</secondary></indexterm>

<para>
<application>Postfix</application> er en moderne MTA (mail transfer agent), dvs. et program til at 
flytte e-post fra én postserver til en anden. I mange år var 
<application>Sendmail</application> den MTA, alle brugte, men i de sidste 
par år har det vist sig, at <application>Sendmail</application> ikke kan
leve op til de sikkerhedskrav, man typisk stiller.
</para>

<para>
<application>Postfix</application> har umiddelbart tre fordele:
  <itemizedlist mark="bullet" spacing="compact">
    <listitem>
      <para>
      Skrevet af Wietse Venema, som er kendt for sin store viden og 
      kunnen inden for edb-sikkerhed.
      </para>
    </listitem>
    <listitem>
      <para>
      Systemet er brudt ned i mange små delprogrammer. Hver komponent er 
      lettere at overskue, og det mindsker risikoen for fejl.
      </para>
    </listitem>
    <listitem>
      <para>
      Langt de fleste komponenter behøver ikke at blive kørt som root,
      hvilket betyder at evt. programmerings- eller konfigureringsfejl ikke
      bliver nær så alvorlige.
      </para>
    </listitem>
  </itemizedlist>
</para>

<para>
Mandrake Linux version 7.1 og senere kommer med
<application>Postfix</application> og
<application>Sendmail</application>, og du kan under installationen
vælge hvilken MTA, du vil bruge. Dette valg har du endnu ikke under
Red Hat eller SuSE, og i det følgende vil vi antage at du har Red Hat
kørende.
</para>

<para>
Først skal du stoppe og afinstallere <application>sendmail</application> 
inden du går i gang med <application>Postfix</application>. 
</para>
<indexterm>
 <primary>cd </primary>
</indexterm>
<indexterm>
 <primary>Kommandooversigt</primary>
 <secondary>cd </secondary>
</indexterm>
<indexterm>
 <primary>rpm </primary>
</indexterm>
<indexterm>
 <primary>Kommandooversigt</primary>
 <secondary>rpm </secondary>
</indexterm>
<screen>
<prompt>[root@linus /root]#</prompt> <userinput>cd /etc/rc.d/init.d</userinput>
<prompt>[root@linus init.d]#</prompt> <userinput>./sendmail stop</userinput>
Shutting down sendmail:                [ OK ]
<prompt>[root@linus init.d]#</prompt> <userinput>rpm -e sendmail</userinput>
</screen>

<para>
Du er nu klar til at downloade og installere
<application>Postfix</application>.  Idet
<application>Postfix</application> endnu ikke er et færdigt produkt,
frigives der jævnligt nye versioner. Du kan finde programmet på <ulink
url="ftp://sunsite.dk">ftp://sunsite.dk</ulink> i kataloget
<filename>/mirrors/ftp.redhat.com/pub/contrib/libc6/i386/</filename>.
Se efter en fil med navnet <filename>postfix-*.i386.rpm</filename> (*
en en dato-stempling, som ændrer sig løbende).
</para>

<para>
Efter du har hentet filen, skal du installere den.
</para>
<indexterm>
 <primary>chkconfig </primary>
</indexterm>
<indexterm>
 <primary>Kommandooversigt</primary>
 <secondary>chkconfig, undersøger og indsætter nye funktioner i et runlevel </secondary>
</indexterm>
<screen>
<prompt>[root@linus /root]#</prompt> <userinput>rpm -i postfix-19991231_pl07-1.i386.rpm</userinput>
postfix-script: Warning: Creating missing Postfix pid directory
postfix-script: Warning: Creating missing incoming directory
postfix-script: Warning: Creating missing bounce directory
postfix-script: Warning: Creating missing defer directory
postfix-script: Warning: Creating missing deferred directory
postfix-script: Warning: Creating missing saved directory
postfix-script: Warning: Creating missing corrupt directory
postfix-script: Warning: Creating missing public directory
postfix-script: Warning: Creating missing private pid directory
<prompt>[root@linus /root]#</prompt> <userinput>mkdir /var/log/mail</userinput>
<prompt>[root@linus /root]#</prompt> <userinput>cd /etc/rc.d/init.d</userinput>
<prompt>[root@linus init.d]#</prompt> <userinput>./postfix start</userinput>
Starting postfix: postfix-script: starting the Postfix mail system
<prompt>[root@linus init.d]#</prompt> <userinput>chkconfig --level 3 postfix on</userinput>
</screen>

<para>
Nu har du fået udskiftet <application>Sendmail</application> med 
<application>Postfix</application>, og den nye MTA vil altid blive startet
op, når du kører i runlevel 3 (den sidste kommandolinje).
</para>

<para>
Konfigurationen af <application>Postfix</application> sker i filen 
<filename>/etc/postfix/main.cf</filename>. Som et minimum skal du
ændre <emphasis>myhostname</emphasis> og <emphasis>mydomain</emphasis> til 
noget fornuftigt, men ofte er det ikke nødvendigt idet Postfix tager denne
information fra sendmail.cf.
Du kan få <application>Postfix</application>
til at genindlæse en konfiguration ved at udføre kommandoen 
<command>postfix reload</command> som root.
</para>

<para>
Postfix har hjemmesiden <ulink url="http://www.postfix.org/">www.postfix.org</ulink>,
hvor der også er en god FAQ.
</para>

</sect1><!-- postfix -->

<sect1 id="news-server">
<title>Linux som newsserver</title>
<indexterm><primary>News-server</primary></indexterm>
<indexterm><primary>NNTP</primary></indexterm>
<indexterm>
 <primary>Servere</primary>
 <secondary>News-server </secondary>
</indexterm>
<indexterm>
 <primary>NNTP-tjeneste</primary>
</indexterm>

<para>
Et naturligt spørgsmål ville være: "Hvorfor skulle man overhovedet
køre en lokal newsserver?". Det er der faktisk flere gode grunde til:
</para>

<itemizedlist mark="bullet">
<listitem>
 <para>
  Hvis der er flere på lokalnettet, som læser de samme nyhedsgrupper, så
  skal de kun downloades én gang.
 </para>
</listitem>

<listitem> 
 <para>
  Hvis man ikke lige kan overskue hvilken newsreader man ønsker at
  bruge, så står man med Leafnode frit for at teste 1.000 newsreadere og
  skal stadig kun downloade serverlister én gang.
 </para>
</listitem>

<listitem> 
 <para>
  Hvis man læser news fra mere end én newsserver
  f.eks. <filename>news.sslug.dk</filename> og
  <filename>news.get2net.dk</filename>, så kan man "slå" disse
  serveres nyhedsgrupper sammen til en lokal server.
 </para>
</listitem>

<listitem> 
 <para>
  Man kan læse news Offline som hvis man var Online. 
 </para>
</listitem>

</itemizedlist>

<para>
Et valg af newsserver er Leafnode.
</para>

<sect2 id="leafnode">
<title>Leafnode, en NNTP-server til hobby-brug</title>
<indexterm><primary>Leafnode</primary></indexterm>

<para>
Ud over de generelle argumenter for at køre nyhedsserver selv, kan vi
tilføje følgende som angår newsserveren Leafnode:
</para>

<itemizedlist mark="bullet">
<listitem>
 <para>
  Rigtig nem konfiguration.
 </para>
</listitem>
<listitem> 
 <para>
  Ingen vedligeholdelse.
 </para>
</listitem>
<listitem> 
 <para>
  Leafnode er en dynamisk newsserver. Den henter kun de grupper der
  faktisk bliver læst.
 </para>
</listitem>
</itemizedlist>

<para>
Så der er faktisk mange gode grunde til at bruge Leafnode.
</para>

<sect3 id="leafnode-installation">
<title>Installation af Leafnode</title>

<para>
Installationen af Leafnode er nem. Til at starte med skal kildekoden
hentes på 
<ulink url="http://www.leafnode.org">http://www.leafnode.org</ulink>. Grunden
til at Leafnode ikke er med i standard-distributionerne, kunne være at
den er dækket af en anden licens end GPL. Grunden til dette kan slås
op i deres FAQ: 18. <literal>Why is Leafnode not licensed under the 
GPL?</literal>
</para>

<para>
<emphasis>There are several reasons: 
1. Originally, Arnt Gulbrandsen licensed Leafnode under his own license: 
Use, modification and distribution is allowed without limitation,
warranty, or liability of any kind.</emphasis>
</para>

<para> 
<emphasis>
This license is very broad. The same spirit is (in my opinion)
contained in the X11 license, which is used by Leafnode nowadays.  
2. I do not like the philosophy of the FSF. They seem to emphasize that
every project they conceived is good whereas everything else is
bad. If they cannot argue the software away this way, they claim it to
be part of the project, such as calling Linux "GNU/Linux".
</emphasis>
</para>

<para>
Det kan man vel så lide eller lade være. 
</para>

<para>
Når man så har hentet tar-pakken og  pakket den ud:
</para>

<screen>
<prompt>[root@linus /root]#</prompt> <userinput>tar -xzvf leafnode-*.tar.gz </userinput>
<prompt>[root@linus /root]#</prompt> <userinput>cd leafnode-*; less INSTALL</userinput>
</screen>

<para>
I denne fil er installationen beskrevet trin for trin, men vi løber
den lige igennem alligevel. Dette er beskrevet fra en Red Hat. Det kan
være at konfigurationsfilerne ligger andre steder på andre
distributioner.
</para>

<screen>
<prompt>[root@linus leafnode]#</prompt> <userinput>./configure; make</userinput>
</screen>

<para>
Herefter skal der oprettes en bruger <emphasis>news</emphasis>:
</para>

<indexterm>
 <primary>adduser </primary>
</indexterm>
<indexterm>
 <primary>Kommandooversigt</primary>
 <secondary>adduser </secondary>
</indexterm>

<screen>
<prompt>[root@linus leafnode]#</prompt> <userinput>adduser news</userinput>
</screen>

<para>
Så må man køre:
</para>

<screen>
<prompt>[root@linus leafnode]#</prompt> <userinput>make install</userinput>
</screen>

<para>
Så skal der rettes i konfigurationsfilen til Leafnode, som er
placeret i <filename>/etc/leafnode/config</filename>. Det interessante
er:
</para>

<screen>
## Dette er en del at Leafnode konfigurationsfilen /etc/leafnode/config
## This is the NNTP server Leafnode fetches its news from.
## You need read and post access to it. Mandatory.
server = news.sslug.dk
</screen>

<para>
Her kan man så bare tilføje flere servere hvis man ønsker at læse fra
flere. Skal der bruges brugernavn/adgangskode på en af dem, tilføjes det
bare nedenunder:
</para>

<screen>
# username = gulbrandsen
# password = secret
</screen>

<para>
Og dette er faktisk alt der skal gøres ved konfigurationsfilen. De
andre parametre er rigtig godt beskrevet og omhandler ting som:
</para>

<itemizedlist mark="bullet">
<listitem>
 <para>
  I hvor lang tid indlæg skal gemmes.
 </para>
</listitem>
<listitem> 
 <para>
  I hvor lang tid der skal hentes nye indlæg, hvis gruppen ikke bliver læst.
 </para>
</listitem>
</itemizedlist>

<para>
Disse parametre kan man altid stille på hvis man synes den ikke
fungerer tilfredsstillende, men default er faktisk rimelig gode
indstillinger.
</para>

<para>
Så skal crontab redigeres for brugeren news.
Som standard anvender crontab editoren vi. Du kan evt. starte med at ændre
dette forhold med kommandoen: <command>EDITOR=emacs; export EDITOR
</command>
eller <command>EDITOR=mcedit; export EDITOR</command>.  Samme kommando
kan tilføjes til din <filename>~/.profile</filename>.
</para>

<indexterm>
 <primary>crontab </primary>
</indexterm>
<indexterm>
 <primary>Kommandooversigt</primary>
 <secondary>crontab </secondary>
</indexterm>

<screen>
<prompt>[root@linus leafnode]#</prompt> <userinput>crontab -u news -e</userinput>
</screen>



<para>
Heri tilføjes linjen:
</para>

<screen>
0 0 * * * /usr/local/sbin/texpire
</screen>

<para>
Dette får den til at slette gamle indlæg hver midnat. Det er
smart hvis man sørger for at det er et tidspunkt hvor computeren er
tændt. Nå, ja, hvis den er tændt, og man sover i samme rum, så lad være
med at sætte den til at køre mens du sover. Der er rimeligt meget tryk
på disken, når denne køres, da der er mange filer der skal checkes
igennem, så det kan man godt vågne af :-).
</para>

<para>
Så skal inet-dæmonen sættes op til at starte Leafnode. Først
kontrolleres at inet er startet (Der skal være en stjerne foran i
ntsysv). Så redigeres filen <filename>/etc/inetd.conf</filename>. Det
er følgende linje der skal ses på: 
</para>

<screen>
nntp stream tcp nowait root /usr/sbin/tcpd /usr/local/sbin/leafnode 
</screen>

<para>
Her er Leafnode sat til at gå igennem tcpwrapperen så der skal også
lige åbnes for denne. I <filename>/etc/hosts.deny</filename> skal der
helst (af sikkerhedsmæssige årsager) stå:
</para>

<screen>
ALL: ALL
</screen>

<para>
hvorefter man redigerer <filename>/etc/hosts.allow</filename> og
indsætter linjen:
</para>

<screen>
leafnode: localhost
</screen>

<para>
Her kan så
tilføjes andre maskiner som skal have lov til at læse (se <command>man
hosts.allow</command>). Og så skal netværks-funktionerne genstartes:
</para>

<screen>
<prompt>[root@linus leafnode]#</prompt> <userinput>/etc/rc.d/init.d/inet restart</userinput>
</screen>

<para>
Eller hvis du bruger Red Hat 7.0
</para>

<screen>
<prompt>[root@linus leafnode]#</prompt> <userinput>/etc/rc.d/init.d/xinetd restart</userinput>
</screen>


<para>
Eller hvis du anvender SuSE 6.4
</para>

<screen>
<prompt>[root@linus leafnode]#</prompt> <userinput>/etc/rc.d/init.d/inetd restart</userinput>
</screen>

<para>
Så er det hele ved at være sat op.  Nu køres
<command>/usr/local/sbin/fetchnews</command> for første gang. Første
gang køres den med <filename>-f</filename> som parameter. Dette får
Leafnode til at læse serverlisterne på de angivne servere. Denne skal
køres som root eller news. Man kan igen putte den i news's crontab
hvis ens forbindelse er oppe hele tiden, ellers kan den med fordel
puttes i ens opkaldsscripts eller man kan køre den manuelt når man
ønsker at poste/hente news. Det sidste har jeg valgt, og derfor har jeg
redigeret <filename>/root/.bashrc</filename> og indsat denne linje: 
</para>

<screen>
alias news='/usr/local/sbin/fetchnews -vvv' 
</screen>

<para>
De 3 v'er giver bare meget output fra <command>fetchnews</command>, og
nu kan jeg skrive news som root og køre
<command>fetchnews</command>. Når man poster gennem Leafnode, bliver
postningerne lagt i kø indtil fetchnews bliver kørt igen, og indlægget
bliver postet mens nye indlæg fra de grupper, der abonneres på, bliver hentet.
Nu mangler vi kun at sætte newsreaderen op til at læse fra localhost i
stedet for den gamle newsserver.
</para>

<para>
Ønsker du automatisk hentning af nyheder hvert kvarter, kan du
yderligere tilføje denne linje i <filename>/etc/crontab</filename>
(kun interessant hvis du har en forbindelse med fast pris):
</para>

<screen>
*/15 * * * * /usr/sbin/fetchnews
</screen>

</sect3>
</sect2>
</sect1>

<sect1 id="ntp">
<title>NTP - tidssynkronisering</title>
<indexterm><primary>NTP</primary></indexterm>
<indexterm><primary>Tid</primary><secondary>NTP tidssynkronisering</secondary></indexterm>

<para>
(x)ntp er et værktøj til synkronisering af tiden på computere. Dette program
sørger for hele tiden at holde systemuret synkroniseret med en anden ntpserver
et sted på Internettet, derfor er det mest oplagt at benytte det på maskiner
der konstant er på Internettet.
</para>

<para>
På installations- CD'erne til de fleste distributioner ligger der (x)ntp-pakker lige
til at installere ellers kan programmet hentes på <ulink url="http://www.ntp.org">http://www.ntp.org</ulink>.
</para>

<indexterm>
 <primary>ntpdate</primary>
</indexterm>
<indexterm>
 <primary>Kommandooversigt</primary>
 <secondary>ntpdate</secondary>
</indexterm>

<para>
ntp-pakken består af 2 værktøjer <command>ntpd</command> (ntp-dæmonen)
og <command>ntpdate</command>, den sidste kører manuelt før man
starter <command>ntpd</command> for at få tiden synkroniseret fra
start, da ntpd <command>nægter</command> at starte hvis tidsforskellen
mellem de 2 maskiner er for stor.
</para>

<para>
Denne kan også kaldes fra ens Internet-opkaldsscripts, hvis man har en
opkaldsforbindelse og syntaksen er bare: <command>ntpdate -s
ntp-server-navn</command>. NTP-servere er der en hel del af rundt
omkring på nettet og din Internetudbyder har højst sandsynligt en:
</para>

<screen>
Worldonline/Tiscali: ntp.worldonline.dk
TeleDK/TDC: ntp.inet.tele.dk
</screen>

<para>
Har du fast Internetforbindelse på din server så kan det være
fordelagtigt at sætte dæmonen op så uret hele tiden holdes
synkroniseret. Denne dæmon kompenserer for hardware-urets drift der er
afhængigt af varme og andre ting.  Det gøres meget nemt ved blot at
tilføje til filen <filename>/etc/ntp.conf</filename>.
</para>

<screen>
server NTP-SERVER-NAVN
driftfile /etc/ntp/drift
</screen>

<para>
og ntpserverens navn som eneste linje i filen
<filename>/etc/ntp/step-tickers</filename>. Så kører ntpdæmonen en
<command>ntpdate</command> mod serveren inden den starter
synkroniseringen.
</para>

<para>
Og så skal dæmonen blot startes med:
<command>/etc/rc.d/init.d/ntpd start</command>
og hakkes af så den starter automatisk i "ntsysv" så den starter i det runlevel
du normalt starter i. 
</para>

<para>
Dette er beskrevet ud fra en Mandrake 8.0 og filernes placering kan afhænge af
distribution og installationsmetode. 
</para>
</sect1>

<sect1 id="hastighed-og-duplex">
<title>Forhandling af hastighed for netkort</title>

<indexterm>
 <primary>mii-tool</primary>
</indexterm>
<indexterm>
 <primary>netkort</primary>
 <secondary>styring af hastighed</secondary>
</indexterm>
<indexterm>
 <primary>Kommandooversigt</primary>
 <secondary>mii-tool</secondary>
</indexterm>


<para>
Et problem som flere Linux-brugere har angår netkort, hvor
man måske har lyst til at styre mellem 10 MBit og 100 MBit, samt og der
anvendes fuld duplex eller ej. Der er ofte en DOS/Windows driver med
til ens netkort, som kan dette - og under Linux skal man bla. se efter
<command>mii-tool</command>. Desværre er det vist ikke alle netkort
som programmet virker sammen med.
</para>
</sect1>
</chapter>
